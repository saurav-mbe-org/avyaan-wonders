<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Avyaan Daily Wonders (Summary Mode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for larger touch targets and mobile-friendly inputs */
        input[type="checkbox"], input[type="radio"] {
            transform: scale(1.5); /* Make checkboxes/radios larger */
        }
        /* Style for the slider to make it easier to grab */
        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 10px;
            background: #d1d5db;
            border-radius: 5px;
            margin-top: 10px;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: #10b981; /* Emerald green */
            cursor: pointer;
        }
        /* Sticky footer adjustments */
        #content-area {
            padding-bottom: 100px; /* Space for the sticky footer */
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">

    <header class="sticky top-0 z-10 bg-white shadow-md p-4 flex justify-between items-center border-b-4 border-emerald-500">
        <h1 class="text-xl font-bold text-gray-800">Avyaan Daily Wonders</h1>
        <div id="current-date-display" class="text-md font-medium text-emerald-600"></div>
    </header>

    <div id="content-area" class="p-4 sm:p-6 max-w-lg mx-auto">
        
        <form id="wonder-report-form" class="space-y-4">
            <input type="hidden" id="date" name="date"> 

            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <button type="button" class="accordion-header w-full text-left p-4 bg-emerald-100 hover:bg-emerald-200 font-semibold text-gray-700 flex justify-between items-center" data-module="module-i">
                    <span>Module I: Independence & Motor Skills</span>
                    <span class="indicator">+</span>
                </button>
                <div class="accordion-content p-4 space-y-4 hidden" id="module-i">
                    
                    <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-md">
                        <input type="checkbox" id="socks_indep" name="socks_indep" class="text-emerald-600 focus:ring-emerald-500 rounded">
                        <label for="socks_indep" class="text-gray-700 font-medium text-lg flex-grow">Wore Socks Independently (100%)?</label>
                    </div>

                    <label for="pants_level" class="block text-gray-700 font-medium">Pants Independence %: <span id="pants_level_value" class="font-bold text-emerald-600">50</span>%</label>
                    <input type="range" id="pants_level" name="pants_level" min="0" max="100" step="1" value="50" class="w-full">
                    <p class="text-sm text-gray-500 mt-1">0=Adult did it, 100=Solo</p>

                    <label class="block text-gray-700 font-medium mb-2">Meal Tool:</label>
                    <div class="flex space-x-4">
                        <label class="flex items-center space-x-2 text-lg">
                            <input type="radio" name="meal_tool" value="Tools" class="text-emerald-600 focus:ring-emerald-500">
                            <span>Tools</span>
                        </label>
                        <label class="flex items-center space-x-2 text-lg">
                            <input type="radio" name="meal_tool" value="Hand" class="text-emerald-600 focus:ring-emerald-500">
                            <span>Hand</span>
                        </label>
                        <label class="flex items-center space-x-2 text-lg">
                            <input type="radio" name="meal_tool" value="Adult_Fed" class="text-emerald-600 focus:ring-emerald-500">
                            <span>Adult_Fed</span>
                        </label>
                    </div>

                    <div>
                        <label for="meal_duration_min" class="block text-gray-700 font-medium">Total Meal Duration (minutes):</label>
                        <input type="number" id="meal_duration_min" name="meal_duration_min" min="0" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg" placeholder="e.g., 25">
                    </div>
                    
                    <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-md">
                        <input type="checkbox" id="post_meal_clear" name="post_meal_clear" class="text-emerald-600 focus:ring-emerald-500 rounded">
                        <label for="post_meal_clear" class="text-gray-700 font-medium text-lg flex-grow">Cleared Own Plate/Cup?</label>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <button type="button" class="accordion-header w-full text-left p-4 bg-emerald-100 hover:bg-emerald-200 font-semibold text-gray-700 flex justify-between items-center" data-module="module-ii">
                    <span>Module II: Communication & Initiation</span>
                    <span class="indicator">+</span>
                </button>
                <div class="accordion-content p-4 space-y-4 hidden" id="module-ii">
                    
                    <div>
                        <label for="spontaneous_requests" class="block text-gray-700 font-medium">Count: Spontaneous Requests (e.g., 'Chai'):</label>
                        <input type="number" id="spontaneous_requests" name="spontaneous_requests" min="0" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg" placeholder="e.g., 5">
                    </div>

                    <div>
                        <label for="new_phrases" class="block text-gray-700 font-medium">New/Scripted Words Today (e.g., 'Mummy go'):</label>
                        <input type="text" id="new_phrases" name="new_phrases" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg" placeholder="List words/phrases">
                    </div>

                    <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-md">
                        <input type="checkbox" id="declarative_point" name="declarative_point" class="text-emerald-600 focus:ring-emerald-500 rounded">
                        <label for="declarative_point" class="text-gray-700 font-medium text-lg flex-grow">Pointed to Share Interest (e.g., 'Look!'):</label>
                    </div>

                    <div>
                        <label for="toilet_initiation_attempts" class="block text-gray-700 font-medium">Count: Toilet Initiation Attempts (e.g., touched card):</label>
                        <input type="number" id="toilet_initiation_attempts" name="toilet_initiation_attempts" min="0" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg" placeholder="e.g., 2">
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <button type="button" class="accordion-header w-full text-left p-4 bg-emerald-100 hover:bg-emerald-200 font-semibold text-gray-700 flex justify-between items-center" data-module="module-iii">
                    <span>Module III: Regulation & Behavior</span>
                    <span class="indicator">+</span>
                </button>
                <div class="accordion-content p-4 space-y-4 hidden" id="module-iii">
                    
                    <div>
                        <label for="meltdown_level" class="block text-gray-700 font-medium">Meltdown Level:</label>
                        <select id="meltdown_level" name="meltdown_level" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg">
                            <option value="">Select Level</option>
                            <option value="None">None</option>
                            <option value="Minor">Minor</option>
                            <option value="Major">Major</option>
                        </select>
                    </div>

                    <div id="meltdown-duration-group" class="hidden">
                        <label for="meltdown_duration_min" class="block text-gray-700 font-medium">Time Lost to Meltdown (minutes):</label>
                        <input type="number" id="meltdown_duration_min" name="meltdown_duration_min" min="0" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg" placeholder="e.g., 15">
                    </div>

                    <div class="flex items-center space-x-3 p-2 bg-gray-50 rounded-md">
                        <input type="checkbox" id="coping_used" name="coping_used" class="text-emerald-600 focus:ring-emerald-500 rounded">
                        <label for="coping_used" class="text-gray-700 font-medium text-lg flex-grow">Used a Self-Soothing Strategy?</label>
                    </div>

                    <div>
                        <label for="sensory_trigger" class="block text-gray-700 font-medium">Sensory Trigger:</label>
                        <select id="sensory_trigger" name="sensory_trigger" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg">
                            <option value="">Select Trigger</option>
                            <option value="Loud Noise">Loud Noise</option>
                            <option value="Transition">Transition</option>
                            <option value="Crowds">Crowds</option>
                            <option value="Unknown">Unknown</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <button type="button" class="accordion-header w-full text-left p-4 bg-emerald-100 hover:bg-emerald-200 font-semibold text-gray-700 flex justify-between items-center" data-module="module-iv">
                    <span>Module IV: Environment & Context</span>
                    <span class="indicator">+</span>
                </button>
                <div class="accordion-content p-4 space-y-4 hidden" id="module-iv">
                    
                    <label for="overall_compliance" class="block text-gray-700 font-medium">Overall Compliance/Prompt Dependency Score (1-10): <span id="overall_compliance_value" class="font-bold text-emerald-600">5</span></label>
                    <input type="range" id="overall_compliance" name="overall_compliance" min="1" max="10" step="1" value="5" class="w-full">
                    <p class="text-sm text-gray-500 mt-1">1=Low Dependency, 10=High Dependency</p>

                    <div>
                        <label for="sleep_quality" class="block text-gray-700 font-medium">Sleep Quality:</label>
                        <select id="sleep_quality" name="sleep_quality" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg">
                            <option value="">Select Quality</option>
                            <option value="Good">Good</option>
                            <option value="Restless">Restless</option>
                            <option value="Delayed">Delayed</option>
                        </select>
                    </div>

                    <div>
                        <label for="therapy_session" class="block text-gray-700 font-medium">Therapy Session:</label>
                        <select id="therapy_session" name="therapy_session" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg">
                            <option value="">Select Session</option>
                            <option value="Speech">Speech</option>
                            <option value="OT">OT</option>
                            <option value="Behavior">Behavior</option>
                            <option value="None">None</option>
                        </select>
                    </div>

                    <div>
                        <label for="biggest_event_note" class="block text-gray-700 font-medium">Biggest Win or Challenge Note:</label>
                        <textarea id="biggest_event_note" name="biggest_event_note" rows="3" class="w-full mt-1 p-3 border border-gray-300 rounded-md text-lg" placeholder="Details about the most significant event of the day."></textarea>
                    </div>
                </div>
            </div>
            </form>
        <div id="json-output-container" class="mt-8 pt-4 hidden">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold text-gray-800">Generated Daily Summary</h3>
                <button type="button" id="copy-json-btn-top" class="bg-emerald-500 hover:bg-emerald-600 text-white text-sm font-bold py-2 px-3 rounded-md transition duration-150">
                    Copy Summary
                </button>
            </div>

            <textarea id="json-output" rows="15" readonly class="w-full p-3 border border-emerald-400 bg-emerald-50 rounded-md font-sans text-sm leading-relaxed"></textarea>
            
            <button type="button" id="back-to-form-btn" class="w-full bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-4 rounded-md mt-4 transition duration-150">
                ← Back to Edit Form
            </button>
        </div>
        </div>

    <footer id="footer-button" class="sticky bottom-0 z-10 bg-white shadow-2xl p-4 border-t-4 border-emerald-500">
        <button id="generate-report-btn" type="submit" form="wonder-report-form" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-black text-xl py-4 rounded-lg transition duration-150 shadow-lg active:scale-[.99]">
            Generate Daily Wonder Report
        </button>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- ELEMENT REFERENCES ---
            const form = document.getElementById('wonder-report-form');
            const dateInput = document.getElementById('date');
            const dateDisplay = document.getElementById('current-date-display');
            const jsonOutput = document.getElementById('json-output');
            const jsonOutputContainer = document.getElementById('json-output-container');
            const generateReportBtn = document.getElementById('generate-report-btn');
            const copyJsonBtnTop = document.getElementById('copy-json-btn-top');
            const backToFormBtn = document.getElementById('back-to-form-btn');
            const footerButton = document.getElementById('footer-button');
            const accordionHeaders = document.querySelectorAll('.accordion-header');
            const meltdownLevelSelect = document.getElementById('meltdown_level');
            const meltdownDurationGroup = document.getElementById('meltdown-duration-group');
            const meltdownDurationInput = document.getElementById('meltdown_duration_min');

            // --- 1. INITIALIZATION & DATE SETUP ---
            const today = new Date();
            const yyyy = today.getFullYear();
            const mm = String(today.getMonth() + 1).padStart(2, '0');
            const dd = String(today.getDate()).padStart(2, '0');
            const currentDate = `${yyyy}-${mm}-${dd}`;
            
            dateInput.value = currentDate;
            dateDisplay.textContent = currentDate;


            // --- 2. LOCAL STORAGE PERSISTENCE (Skipping full implementation details for brevity) ---
            const STORAGE_KEY = 'adw_form_state';
            // ... (loadState and saveState functions remain the same) ...

            const loadState = () => {
                const savedState = localStorage.getItem(STORAGE_KEY);
                if (savedState) {
                    const state = JSON.parse(savedState);
                    Object.keys(state).forEach(key => {
                        const element = form.elements[key];
                        if (element) {
                            const value = state[key];
                            if (element.type === 'checkbox') {
                                element.checked = value;
                            } else if (element.type === 'radio') {
                                const radio = form.querySelector(`input[name="${key}"][value="${value}"]`);
                                if (radio) radio.checked = true;
                            } else {
                                element.value = value;
                            }
                        }
                    });
                    updateSliderDisplay('pants_level');
                    updateSliderDisplay('overall_compliance');
                    toggleMeltdownDuration();
                }
            };

            const saveState = () => {
                const data = {};
                Array.from(form.elements).forEach(element => {
                    if (element.name && element.type !== 'submit' && element.type !== 'button') {
                        if (element.type === 'radio' && !element.checked) {
                            return; 
                        }

                        if (element.type === 'checkbox') {
                            data[element.name] = element.checked;
                        } else if (element.type === 'radio') {
                            data[element.name] = element.value;
                        } else {
                            data[element.name] = element.value;
                        }
                    }
                });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            };

            form.addEventListener('input', saveState);
            // --- End of Persistence Block ---


            // --- 3. UI HELPER FUNCTIONS ---
            
            // Function to handle switching between screens
            const showReportScreen = () => {
                form.classList.add('hidden');
                footerButton.classList.add('hidden');
                jsonOutputContainer.classList.remove('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const showFormScreen = () => {
                form.classList.remove('hidden');
                footerButton.classList.remove('hidden');
                jsonOutputContainer.classList.add('hidden');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            // Accordion and Slider functions (remain the same)
            accordionHeaders.forEach(header => {
                header.addEventListener('click', () => {
                    // ... (accordion logic) ...
                    const contentId = header.getAttribute('data-module');
                    const content = document.getElementById(contentId);
                    const indicator = header.querySelector('.indicator');

                    const isHidden = content.classList.contains('hidden');

                    document.querySelectorAll('.accordion-content').forEach(c => c.classList.add('hidden'));
                    document.querySelectorAll('.accordion-header .indicator').forEach(i => i.textContent = '+');

                    if (isHidden) {
                        content.classList.remove('hidden');
                        indicator.textContent = '–';
                    } else {
                        content.classList.add('hidden');
                        indicator.textContent = '+';
                    }
                });
            });

            const updateSliderDisplay = (id) => {
                const slider = document.getElementById(id);
                const valueSpan = document.getElementById(`${id}_value`);
                if (slider && valueSpan) {
                    valueSpan.textContent = slider.value;
                }
            };

            document.getElementById('pants_level').addEventListener('input', () => updateSliderDisplay('pants_level'));
            document.getElementById('overall_compliance').addEventListener('input', () => updateSliderDisplay('overall_compliance'));

            const toggleMeltdownDuration = () => {
                const level = meltdownLevelSelect.value;
                if (level === 'Minor' || level === 'Major') {
                    meltdownDurationGroup.classList.remove('hidden');
                } else {
                    meltdownDurationGroup.classList.add('hidden');
                    meltdownDurationInput.value = ''; 
                }
                saveState(); 
            };
            meltdownLevelSelect.addEventListener('change', toggleMeltdownDuration);


            // --- 4. SUBMISSION & SUMMARY GENERATION (Updated for screen transition) ---

            form.addEventListener('submit', (e) => {
                e.preventDefault(); 
                
                // 1. GATHER RAW DATA (Same as previous version)
                const data = {
                    date: dateInput.value,
                    socks_indep: document.getElementById('socks_indep').checked,
                    pants_level: parseInt(document.getElementById('pants_level').value || 0),
                    meal_tool: form.elements['meal_tool'].value || 'N/A',
                    meal_duration_min: parseInt(document.getElementById('meal_duration_min').value || 0),
                    post_meal_clear: document.getElementById('post_meal_clear').checked,
                    spontaneous_requests: parseInt(document.getElementById('spontaneous_requests').value || 0),
                    new_phrases: document.getElementById('new_phrases').value || "None.",
                    declarative_point: document.getElementById('declarative_point').checked,
                    toilet_initiation_attempts: parseInt(document.getElementById('toilet_initiation_attempts').value || 0),
                    meltdown_level: document.getElementById('meltdown_level').value || 'N/A',
                    meltdown_duration_min: meltdownDurationInput.value ? parseInt(meltdownDurationInput.value) : 0,
                    coping_used: document.getElementById('coping_used').checked,
                    sensory_trigger: document.getElementById('sensory_trigger').value || 'N/A',
                    overall_compliance: parseInt(document.getElementById('overall_compliance').value || 5),
                    sleep_quality: document.getElementById('sleep_quality').value || 'N/A',
                    therapy_session: document.getElementById('therapy_session').value || 'N/A',
                    biggest_event_note: document.getElementById('biggest_event_note').value || "No detailed note provided."
                };

                // 2. GENERATE HUMAN-READABLE SUMMARY (Same as previous version)
                let summary = `DAILY WONDER REPORT - ${data.date}\n\n`;
                summary += `---------------------------------------------------\n`;
                summary += `[I] INDEPENDENCE & MOTOR SKILLS\n`;
                summary += ` - Socks Independence: ${data.socks_indep ? '100% - Solo' : 'Assisted/Did not attempt'}\n`;
                summary += ` - Pants Independence: ${data.pants_level}% (Slider Score)\n`;
                summary += ` - Meal Method/Duration: ${data.meal_tool} for ${data.meal_duration_min} min.\n`;
                summary += ` - Post-Meal Clear: ${data.post_meal_clear ? 'Yes' : 'No'}\n\n`;
                summary += `[II] COMMUNICATION & INITIATION\n`;
                summary += ` - Spontaneous Requests: ${data.spontaneous_requests} count.\n`;
                summary += ` - New/Scripted Phrases: ${data.new_phrases}\n`;
                summary += ` - Declarative Pointing: ${data.declarative_point ? 'Yes (Pointed to share interest)' : 'No'}\n`;
                summary += ` - Toilet Initiation Attempts: ${data.toilet_initiation_attempts} count.\n\n`;
                summary += `[III] REGULATION & BEHAVIOR\n`;
                summary += ` - Meltdown Level: ${data.meltdown_level}\n`;
                if (data.meltdown_level !== 'None' && data.meltdown_duration_min > 0) {
                    summary += ` - Time Lost to Meltdown: ${data.meltdown_duration_min} minutes.\n`;
                } else if (data.meltdown_level !== 'None') {
                    summary += ` - Time Lost to Meltdown: Not recorded or 0 minutes.\n`;
                }
                summary += ` - Coping Strategy Used: ${data.coping_used ? 'Yes' : 'No'}\n`;
                summary += ` - Sensory Trigger: ${data.sensory_trigger}\n\n`;
                summary += `[IV] ENVIRONMENT & CONTEXT\n`;
                summary += ` - Overall Compliance Score: ${data.overall_compliance}/10\n`;
                summary += ` - Sleep Quality: ${data.sleep_quality}\n`;
                summary += ` - Therapy Session: ${data.therapy_session}\n`;
                summary += `\n** Biggest Note (Win/Challenge) **\n`;
                summary += `${data.biggest_event_note}\n`;
                summary += `---------------------------------------------------\n`;


                // 3. OUTPUT DISPLAY & SCREEN TRANSITION
                jsonOutput.value = summary;
                showReportScreen(); 
            });


            // --- 5. NAVIGATION & COPY LOGIC ---
            
            // Handle Back Button Click
            backToFormBtn.addEventListener('click', showFormScreen);

            // Function to handle copying the text
            const copySummaryText = (buttonElement) => {
                jsonOutput.select();
                navigator.clipboard.writeText(jsonOutput.value)
                    .then(() => {
                        buttonElement.textContent = 'Copied! ✅';
                        setTimeout(() => {
                            buttonElement.textContent = 'Copy Summary';
                        }, 2000);
                    })
                    .catch(err => {
                        console.error('Could not copy text: ', err);
                        alert('Failed to copy. Please copy the text manually.');
                    });
            };

            // Attach copy function to the new top-right button
            copyJsonBtnTop.addEventListener('click', () => copySummaryText(copyJsonBtnTop));
            
            // --- FINAL SETUP ---
            loadState(); 
            toggleMeltdownDuration(); 
        });
    </script>
</body>
</html>